// ===== Пресеты (мировые события) =====

// 1) demand - Это шок спроса по конкретному ресурсу. → в «урожайный год» на работу в полях идёт больше людей, спрос на труд ↑ на 5%.

// 2) supply - Это шок предложения по ресурсу. → урожайный год → предложение зерна ↑ на 30%.

// 3) markups - Это надбавки к мультипликатору цены, которые действуют сразу на все ресурсы. 
//→ зерна стало много, хранить его дороже (+2%), но маржа продавцов падает (–2%), потому что конкуренция.
// считается так:
        // mult = 1 + transport + storage + risk + profit
        // transport — удорожание из-за логистики (засады, зима, блокада).
        // storage — издержки хранения (излишки урожая, дорогие склады).
        // risk — премия за риски (война, нестабильность).
        // profit — наценка продавца (когда спрос ↑ или дефицит).

// Итоговая формула цены:
// price[r] = basePrice[r]
//          * ( demand[r] / supply[r] ) ^ elasticity[r]
//          * (1 + transport + storage + risk + profit)
// basePrice[r] — базовая цена.
// (D/S)^elas — эффект локальных шоков (demand/supply).
// (1+… markups) — глобальный мультипликатор от событий/сезонов.

window.WORLD = {
  "урожайный год": { demand: {"труд": +0.05}, supply: {"зерно": +0.30}, markups: {storage:+0.02, profit:-0.02} },
  "мирное время":  { demand: {"оружие": -0.10,"доспех":-0.10}, markups: {risk:-0.03, transport:-0.02} },
  "война":         { demand: {"труд": +0.08,"железо": +0.10,"древесина": +0.10,"оружие": +0.20,"зерно": +0.05,"доспех":+0.20},
                     supply: {"труд": -0.02,"зерно": -0.05}, markups: {risk:+0.07, transport:+0.03, profit:+0.05} },
  "чума":          { demand: {"труд": -0.10,"зерно": -0.05,"оружие": -0.10,"доспех":-0.05},
                     supply: {"труд": -0.20,"рыба": -0.10}, markups: {risk:+0.05} },
  "голод":         { demand: {"зерно": +0.25,"труд": -0.05}, supply: {"зерно": -0.30}, markups: {risk:+0.05, profit:+0.04} },
  "засады на торговых путях": { supply: {"зерно": -0.10,"железо": -0.10,"древесина": -0.08,"рыба": -0.08,"хлопок": -0.08},
                                markups: {transport:+0.05, risk:+0.06, profit:+0.03} },
  "восстановительные работы": { demand: {"труд": +0.10,"древесина": +0.15,"камень": +0.15,"железо": +0.10}, markups: {transport:+0.01} },
  "безопасные дороги":        { supply: {"зерно": +0.05,"железо": +0.05,"древесина": +0.05,"рыба": +0.05,"хлопок": +0.05},
                                markups: {transport:-0.04, risk:-0.03, profit:-0.01} },

  "Гиперурожай":                { supply: {"зерно": +0.80}, demand: {"труд": +0.03}, markups: {storage:+0.10, profit:-0.05} },
 // "Демпинг мельника (30%)":     { supply: {"зерно": +0.30}, markups: {profit:-0.15} },
 // "Золотой стресс (мимики)":    { supply: {"золото": -0.20}, demand: {"золото": +0.40}, markups: {risk:+0.10, transport:+0.03} },
 // "ликвидность↓ (частичный дефолт)": { demand: {"оружие": -0.10,"железо": -0.10,"древесина": -0.08,"труд": -0.05}, markups: {risk:+0.07, profit:+0.03} },
 // "альтернативы для богатых (дороги небезопасны)": { supply: {"рыба": -0.10,"мясо": -0.15,"овощи": -0.12}, markups: {transport:+0.05, profit:+0.04} },
 // "погромы и бунты":           { demand: {"оружие": +0.10,"труд": -0.05}, supply: {"зерно": -0.05}, markups: {risk:+0.10} },
 // "поджоги зернохранилищ":     { supply: {"зерно": -0.60}, markups: {risk:+0.05, storage:-0.05, profit:+0.10} },
  "банковский дефолт":         { demand: {"зерно": +0.08,"хлеб": +0.08,"рыба": +0.04,"труд": -0.05,"железо": -0.08,"древесина": -0.05,"оружие": -0.06,"золото": +0.25},
                                supply: {"золото": -0.30}, markups: {risk:+0.10, profit:+0.03, transport:+0.01} }
};

// взаимоисключающие пары
window.WORLD_MUTEX = {
  "война": ["мирное время"],
  "мирное время": ["война"],
  "голод": ["урожайный год"],
  "урожайный год": ["голод"]
};

// сезоны (взаимоисключающие)
window.SEASONS = {
  "весна": { demand: {"труд": +0.05,"древесина": +0.05}, supply: {"зерно": -0.10}, markups: {transport:+0.02} },
  "лето":  { supply: {"рыба": +0.10}, markups: {storage:+0.01} },
  "осень": { demand: {"труд": +0.03}, supply: {"зерно": +0.40}, markups: {storage:+0.02} },
  "зима":  { demand: {"древесина": +0.08}, supply: {"рыба": -0.15}, markups: {transport:+0.04, storage:+0.03} }
};

// Переключатели
window.toggleSeason = function(name){
  if (activeSeasons.has(name)) activeSeasons.delete(name);
  else { activeSeasons.clear(); activeSeasons.add(name); }
  drawPresets?.(); recalc?.();
};
window.toggleWorld = function(name){
  if (activeWorld.has(name)) { activeWorld.delete(name); }
  else {
    (WORLD_MUTEX[name] || []).forEach(c => activeWorld.delete(c));
    activeWorld.add(name);
  }
  drawPresets?.(); recalc?.();
};
